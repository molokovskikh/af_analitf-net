<UserControl x:Class="AnalitF.Net.Client.Views.Mails"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:themes="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero"
	xmlns:binders="clr-namespace:AnalitF.Net.Client.Binders"
	xmlns:cal="http://www.caliburnproject.org"
	xmlns:models="clr-namespace:AnalitF.Net.Client.Models"
	xmlns:controls="clr-namespace:AnalitF.Net.Client.Controls"
	binders:FocusBehavior.DefaultFocus="{x:Reference Items}">

	<UserControl.Resources>
		<Geometry x:Key="IconDownArrow">M 0,5 L 4.5,10 L 9,5 L 6,5 L6,0 L 3,0 L 3,5 Z</Geometry>
		<Geometry x:Key="IconUpArrow">M 4.5,0 L 9,5 L 6,5 L 6,10 L 3,10 L 3,5 L 0,5 Z</Geometry>
		<Geometry x:Key="IconWarning">F1 M 58.5832,55.4172L 17.4169,55.4171C 15.5619,53.5621 15.5619,50.5546 17.4168,48.6996L 35.201,15.8402C 37.056,13.9852 40.0635,13.9852 41.9185,15.8402L 58.5832,48.6997C 60.4382,50.5546 60.4382,53.5622 58.5832,55.4172 Z M 34.0417,25.7292L 36.0208,41.9584L 39.9791,41.9583L 41.9583,25.7292L 34.0417,25.7292 Z M 38,44.3333C 36.2511,44.3333 34.8333,45.7511 34.8333,47.5C 34.8333,49.2489 36.2511,50.6667 38,50.6667C 39.7489,50.6667 41.1666,49.2489 41.1666,47.5C 41.1666,45.7511 39.7489,44.3333 38,44.3333 Z</Geometry>
		<Geometry x:Key="IconRepeat">F1 M 15.8335,42.75L 15.8334,25.3333L 46.3125,25.3333L 39.5833,19L 49.875,19L 60.1667,28.5L 49.875,38L 39.5833,38L 46.3125,31.6667L 22.1667,31.6667L 22.1667,37.2083L 15.8335,42.75 Z M 60.1667,33.25L 60.1667,50.6667L 29.6875,50.6667L 36.4167,57L 26.125,57L 15.8333,47.5L 26.125,38L 36.4167,38L 29.6875,44.3334L 53.8333,44.3333L 53.8333,38.7917L 60.1667,33.25 Z</Geometry>
		<Geometry x:Key="IconDownload">F1 M 25,52L 51,52L 51,57L 25,57L 25,52 Z M 35,16L 41,16L 41,36.5L 49,27L 49,36.5L 38,49L 27,36.5L 27,27L 35,36.5L 35,16 Z</Geometry>
		<Geometry x:Key="IconClip">F1 M 42.75,24.5417L 42.7499,44.3334C 42.7499,46.9567 40.6233,49.0834 37.9999,49.0834C 35.3766,49.0834 33.25,46.9567 33.25,44.3334L 33.25,28.5L 36.4166,28.5L 36.4166,44.3334C 36.4166,45.2078 37.1255,45.9167 37.9999,45.9167C 38.8744,45.9167 38.7916,45.2078 38.7916,44.3334L 38.7917,24.5417C 38.7917,22.3556 37.8111,20.5833 35.625,20.5833C 33.4389,20.5833 31.6667,22.3555 31.6667,24.5417L 31.6667,49.0833C 31.6667,52.5811 34.5022,55.4167 38,55.4167C 41.4978,55.4167 44.3333,52.5811 44.3333,49.0833L 44.3333,30.0833L 49.0833,30.0833L 49.0833,49.0833C 49.0833,55.2045 44.1211,60.1667 38,60.1667C 31.8788,60.1667 26.9167,55.2045 26.9167,49.0833L 26.9167,23.75C 26.9167,19.3778 30.4611,15.8333 34.8333,15.8333C 39.2056,15.8333 42.75,19.3778 42.75,23.75L 42.7109,24.5417L 42.75,24.5417 Z</Geometry>
		<Geometry x:Key="IconSearch">F1 M 14.8076,31.1139L 20.0677,25.9957C 19.3886,24.8199 19.25,23.4554 19.25,22C 19.25,17.5817 22.5817,14 27,14C 31.4183,14 35,17.5817 35,22C 35,26.4183 31.4183,29.75 27,29.75C 25.6193,29.75 24.3204,29.6502 23.1868,29.0345L 17.8861,34.1924C 17.105,34.9734 15.5887,34.9734 14.8076,34.1924C 14.0266,33.4113 14.0266,31.895 14.8076,31.1139 Z M 27,17C 24.2386,17 22,19.2386 22,22C 22,24.7614 24.2386,27 27,27C 29.7614,27 32,24.7614 32,22C 32,19.2386 29.7614,17 27,17 Z</Geometry>
		<Geometry x:Key="IconCancel">F1 M 38,19C 48.4934,19 57,27.5066 57,38C 57,48.4934 48.4934,57 38,57C 27.5066,57 19,48.4934 19,38C 19,27.5066 27.5066,19 38,19 Z M 38,23.75C 35.2116,23.75 32.6102,24.5509 30.4134,25.9352L 50.0648,45.5866C 51.4491,43.3898 52.25,40.7884 52.25,38C 52.25,30.13 45.87,23.75 38,23.75 Z M 23.75,38C 23.75,45.8701 30.1299,52.25 38,52.25C 40.7884,52.25 43.3897,51.4491 45.5865,50.0649L 25.9351,30.4136C 24.5509,32.6103 23.75,35.2117 23.75,38 Z</Geometry>
		<Geometry x:Key="IconDelete">M0,8 L8,0 M0,0 L8,8</Geometry>
		<Geometry x:Key="IconMail">M1.5,4.5 C1.5,2.8431458 2.8431458,1.5 4.5,1.5 L35.5,1.5 C37.156854,1.5 38.5,2.8431458 38.5,4.5 L38.5,25.5 C38.5,27.156854 37.156854,28.5 35.5,28.5 L4.5,28.5 C2.8431458,28.5 1.5,27.156854 1.5,25.5 z M20,15 L2,27.188 M20,15 L37.812001,26.938 M2.083,2.458 C14.917148,15.957968 15.708,17.249999 15.708,17.249999 M24.229,17.166999 L37.708,2.2500001</Geometry>
		<Geometry x:Key="IconOpenMail">M14.4845,4.4530001 L14.505,12.251958 C14.505,12.804266 13.996778,13.252 13.369855,13.252 L1.6400203,13.252 C1.0130969,13.252 0.50487505,12.804266 0.50487505,12.251958 L0.5,4.5308761 M7.5049998,8.7520001 L0.69399999,12.815 M7.505,8.7520001 L14.245,12.731 M0.726,4.5710001 C5.5817823,9.0712941 5.8810001,9.5020003 5.8810001,9.5020003 M9.105,9.4740001 L14.39075,4.46875 M7.5160001,0.50000005 L0.60899999,4.4580001 M7.5092022,0.49417611 L14.436202,4.369176</Geometry>

		<Style x:Key="Borderless" TargetType="Control">
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="False">
					<Setter Property="Background" Value="Transparent" />
					<Setter Property="BorderBrush" Value="Transparent" />
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style TargetType="ButtonBase" x:Key="MarkerButton">
			<Setter Property="Foreground" Value="{x:Static SystemColors.HighlightBrush}" />
			<Setter Property="IsTabStop" Value="False" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ButtonBase">
						<ContentPresenter Margin="{TemplateBinding Padding}"
							VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
							HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
							RecognizesAccessKey="True"
							SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsMouseOver" Value="False">
					<Setter Property="Foreground" Value="{x:Static SystemColors.ActiveBorderBrush}"/>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="ToggleMarker" TargetType="ToggleButton">
			<Setter Property="Cursor" Value="Hand" />
			<Setter Property="IsTabStop" Value="False" />
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ToggleButton">
						<ContentPresenter Margin="{TemplateBinding Padding}"
								VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
								HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
								RecognizesAccessKey="True"
								SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
								ContentTemplate="{TemplateBinding ContentTemplate}" />
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style x:Key="FlagMarker" TargetType="ToggleButton" BasedOn="{StaticResource ToggleMarker}">
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<Canvas Width="11" Height="15" Background="Transparent">
							<Path Fill="Transparent" Stroke="Gray" StrokeThickness="0.5"
								Canvas.Left="0" Canvas.Top="0" Stretch="Fill" 
								Data="M0.6110918,3.9443045E-31 L1.2222222,3.9443045E-31 C1.5597023,3.9443045E-31 1.833314,0.27978993 1.833314,0.62497864 L1.833314,14.374982 C1.833314,14.720171 1.5597023,15.000001 1.2222222,15.000001 L0.6110918,15.000001 C0.27361168,15.000001 3.9443045E-31,14.720171 3.9443045E-31,14.374982 L3.9443045E-31,0.62497864 C3.9443045E-31,0.27978993 0.27361168,3.9443045E-31 0.6110918,3.9443045E-31 z" Width="1.833" Height="15"/>
							<Path Fill="Transparent" Stroke="Gray" StrokeThickness="0.5"
								Canvas.Left="2.444" Canvas.Top="0.625" Stretch="Fill"
								Data="M3.9704669E-23,1.2499968 C0.6110918,0.83333119 1.2222222,0.41666561 2.24076,0.52086161 3.2592592,0.62501813 4.6852044,1.2500757 5.8055458,1.2500757 6.9259258,1.2500757 7.7407406,0.62501813 8.5555554,2.2296394E-08 L8.5555554,5.6249262 C7.7407406,6.2499443 6.9259258,6.8749624 5.8055458,6.8749624 4.6852044,6.8749624 3.2592592,6.2499443 2.24076,6.1457483 1.2222222,6.0415918 0.6110918,6.4582574 3.9704669E-23,6.874923 L3.9704669E-23,1.2499968 z" Width="8.556" Height="6.875"/>
						</Canvas>
					</DataTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsChecked" Value="True">
					<Setter Property="ContentTemplate">
						<Setter.Value>
							<DataTemplate>
								<Canvas Width="11" Height="15" Background="Transparent">
									<Path Fill="Gray" Canvas.Left="0" Canvas.Top="0" Stretch="Fill"
										Data="M0.6110918,3.9443045E-31 L1.2222222,3.9443045E-31 C1.5597023,3.9443045E-31 1.833314,0.27978993 1.833314,0.62497864 L1.833314,14.374982 C1.833314,14.720171 1.5597023,15.000001 1.2222222,15.000001 L0.6110918,15.000001 C0.27361168,15.000001 3.9443045E-31,14.720171 3.9443045E-31,14.374982 L3.9443045E-31,0.62497864 C3.9443045E-31,0.27978993 0.27361168,3.9443045E-31 0.6110918,3.9443045E-31 z" Width="1.833" Height="15"/>
									<Path Fill="Red" Canvas.Left="2.444" Canvas.Top="0.625" Stretch="Fill"
										Data="M3.9704669E-23,1.2499968 C0.6110918,0.83333119 1.2222222,0.41666561 2.24076,0.52086161 3.2592592,0.62501813 4.6852044,1.2500757 5.8055458,1.2500757 6.9259258,1.2500757 7.7407406,0.62501813 8.5555554,2.2296394E-08 L8.5555554,5.6249262 C7.7407406,6.2499443 6.9259258,6.8749624 5.8055458,6.8749624 4.6852044,6.8749624 3.2592592,6.2499443 2.24076,6.1457483 1.2222222,6.0415918 0.6110918,6.4582574 3.9704669E-23,6.874923 L3.9704669E-23,1.2499968 z" Width="8.556" Height="6.875"/>
								</Canvas>
							</DataTemplate>
						</Setter.Value>
					</Setter>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="NewMarker" TargetType="ToggleButton" BasedOn="{StaticResource ToggleMarker}">
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<!--Background="Transparent" - нужно для того что бы правилно работал hittest-->
						<Canvas Height="14" Width="15" Background="Transparent">
							<Path Stroke="Gray" Height="14" Width="15" Stretch="Fill"
								StrokeEndLineCap="Round" StrokeStartLineCap="Round"
								Data="{StaticResource IconOpenMail}" />
						</Canvas>
					</DataTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsChecked" Value="True">
					<Setter Property="ContentTemplate">
						<Setter.Value>
							<DataTemplate>
								<Canvas Height="10" Width="15" Background="Transparent">
									<Path Stroke="Gray" Height="10" Stretch="Fill" Width="15"
										StrokeEndLineCap="Round" StrokeStartLineCap="Round"
										Fill="Gold"
										Data="{StaticResource IconMail}" />
								</Canvas>
							</DataTemplate>
						</Setter.Value>
					</Setter>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="FlagMarkerButton" TargetType="ToggleButton" BasedOn="{StaticResource Borderless}">
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<StackPanel Orientation="Horizontal">
							<Canvas Height="15" Width="11" Margin="3">
								<Path Fill="Transparent" Stroke="Gray" StrokeThickness="0.5"
									Canvas.Left="0" Canvas.Top="0" Stretch="Uniform"
									Data="M0.6110918,3.9443045E-31 L1.2222222,3.9443045E-31 C1.5597023,3.9443045E-31 1.833314,0.27978993 1.833314,0.62497864 L1.833314,14.374982 C1.833314,14.720171 1.5597023,15.000001 1.2222222,15.000001 L0.6110918,15.000001 C0.27361168,15.000001 3.9443045E-31,14.720171 3.9443045E-31,14.374982 L3.9443045E-31,0.62497864 C3.9443045E-31,0.27978993 0.27361168,3.9443045E-31 0.6110918,3.9443045E-31 z" />
								<Path Fill="Transparent" Stroke="Gray" StrokeThickness="0.5"
									Canvas.Left="2.444" Canvas.Top="0.625" Stretch="Uniform"
									Data="M3.9704669E-23,1.2499968 C0.6110918,0.83333119 1.2222222,0.41666561 2.24076,0.52086161 3.2592592,0.62501813 4.6852044,1.2500757 5.8055458,1.2500757 6.9259258,1.2500757 7.7407406,0.62501813 8.5555554,2.2296394E-08 L8.5555554,5.6249262 C7.7407406,6.2499443 6.9259258,6.8749624 5.8055458,6.8749624 4.6852044,6.8749624 3.2592592,6.2499443 2.24076,6.1457483 1.2222222,6.0415918 0.6110918,6.4582574 3.9704669E-23,6.874923 L3.9704669E-23,1.2499968 z" />
							</Canvas>
							<TextBlock VerticalAlignment="Center">Отметка</TextBlock>
						</StackPanel>
					</DataTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsChecked" Value="True">
					<Setter Property="ContentTemplate">
						<Setter.Value>
							<DataTemplate>
								<StackPanel Orientation="Horizontal">
									<Canvas Height="15" Width="11" Margin="3">
										<Path Fill="Gray" Canvas.Left="0" Canvas.Top="0" Stretch="Uniform"
											Data="M0.6110918,3.9443045E-31 L1.2222222,3.9443045E-31 C1.5597023,3.9443045E-31 1.833314,0.27978993 1.833314,0.62497864 L1.833314,14.374982 C1.833314,14.720171 1.5597023,15.000001 1.2222222,15.000001 L0.6110918,15.000001 C0.27361168,15.000001 3.9443045E-31,14.720171 3.9443045E-31,14.374982 L3.9443045E-31,0.62497864 C3.9443045E-31,0.27978993 0.27361168,3.9443045E-31 0.6110918,3.9443045E-31 z"/>
										<Path Fill="Red" Canvas.Left="2.444" Canvas.Top="0.625" Stretch="Uniform"
											Data="M3.9704669E-23,1.2499968 C0.6110918,0.83333119 1.2222222,0.41666561 2.24076,0.52086161 3.2592592,0.62501813 4.6852044,1.2500757 5.8055458,1.2500757 6.9259258,1.2500757 7.7407406,0.62501813 8.5555554,2.2296394E-08 L8.5555554,5.6249262 C7.7407406,6.2499443 6.9259258,6.8749624 5.8055458,6.8749624 4.6852044,6.8749624 3.2592592,6.2499443 2.24076,6.1457483 1.2222222,6.0415918 0.6110918,6.4582574 3.9704669E-23,6.874923 L3.9704669E-23,1.2499968 z"/>
									</Canvas>
									<TextBlock VerticalAlignment="Center">Отметка</TextBlock>
								</StackPanel>
							</DataTemplate>
						</Setter.Value>
					</Setter>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="NewMarkerButton" TargetType="ToggleButton" BasedOn="{StaticResource Borderless}">
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<!--Background="Transparent" - нужно для того что бы правилно работал hittest-->
						<StackPanel Orientation="Horizontal">
							<Path Stroke="Gray" Height="15" Width="16" Stretch="Uniform"
								StrokeEndLineCap="Round" StrokeStartLineCap="Round"
								Margin="3"
								Data="{StaticResource IconOpenMail}"/>
							<TextBlock VerticalAlignment="Center">Прочитанное</TextBlock>
						</StackPanel>
					</DataTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsChecked" Value="True">
					<Setter Property="ContentTemplate">
						<Setter.Value>
							<DataTemplate>
								<StackPanel Orientation="Horizontal">
									<Path Stroke="Gray" Height="10" Stretch="Fill" Width="15"
										StrokeEndLineCap="Round" StrokeStartLineCap="Round"
										Fill="Gold"
										Margin="3"
										Data="{StaticResource IconMail}" />
									<TextBlock VerticalAlignment="Center">Непрочитанное</TextBlock>
								</StackPanel>
							</DataTemplate>
						</Setter.Value>
					</Setter>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="AttachmentsMark" TargetType="ContentControl">
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<Canvas x:Name="appbar_paperclip" Width="6" Height="12" Visibility="{TemplateBinding Visibility}">
							<Path Width="6" Height="12" Stretch="Fill" Fill="Gray" Data="{StaticResource IconClip}"/>
						</Canvas>
					</DataTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style x:Key="SubjectStyle" TargetType="TextBlock">
			<Style.Triggers>
				<DataTrigger Binding="{Binding IsNew}" Value="True">
					<DataTrigger.Setters>
						<Setter Property="FontWeight" Value="SemiBold" />
					</DataTrigger.Setters>
				</DataTrigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="SenderStyle" TargetType="TextBlock">
			<Setter Property="Foreground" Value="{x:Static SystemColors.GrayTextBrush}"/>
			<Style.Triggers>
				<DataTrigger Binding="{Binding IsSpecial}" Value="True">
					<DataTrigger.Setters>
						<Setter Property="FontSize" Value="14" />
						<Setter Property="Foreground" Value="{x:Static SystemColors.ControlTextBrush}" />
					</DataTrigger.Setters>
				</DataTrigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="SortDirectionMarker" TargetType="ToggleButton" BasedOn="{StaticResource Borderless}">
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<StackPanel Orientation="Horizontal">
							<TextBlock>По убыванию</TextBlock>
							<Path Data="{StaticResource IconDownArrow}" VerticalAlignment="Center" Margin="5, 0, 3, 0"
								Fill="{x:Static SystemColors.HighlightBrush}" Height="10" Width="9"></Path>
						</StackPanel>
					</DataTemplate>
				</Setter.Value>
			</Setter>
			<Style.Triggers>
				<Trigger Property="IsChecked" Value="True">
					<Trigger.Setters>
						<Setter Property="ContentTemplate">
							<Setter.Value>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<TextBlock>По возрастанию</TextBlock>
										<Path Data="{StaticResource IconUpArrow}" VerticalAlignment="Center" Margin="5, 0, 3, 0"
											Fill="{x:Static SystemColors.HighlightBrush}" Height="10" Width="9" />
									</StackPanel>
								</DataTemplate>
							</Setter.Value>
						</Setter>
					</Trigger.Setters>
				</Trigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="Attachment" TargetType="ContentControl">
			<Style.Setters>
				<Setter Property="Template">
					<Setter.Value>
						<ControlTemplate>
							<Button Style="{StaticResource Borderless}"
								HorizontalAlignment="Left"
								cal:Message.Attach="[Event Click] = [Action Download($dataContext)]"
								ToolTip="{Binding Details}">
								<StackPanel Orientation="Horizontal">
									<Path Data="{StaticResource IconDownload}" VerticalAlignment="Center" Margin="5"
										Fill="Black" Stretch="Uniform" Height="15" Width="15" />
									<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
								</StackPanel>
							</Button>
						</ControlTemplate>
					</Setter.Value>
				</Setter>
			</Style.Setters>
			<Style.Triggers>
				<DataTrigger Binding="{Binding IsDownloading}" Value="True">
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate>
								<StackPanel HorizontalAlignment="Left">
									<ProgressBar IsIndeterminate="{Binding IsConnecting}" Value="{Binding Progress}"
										HorizontalAlignment="Center"
										Height="10"
										Width="100" />
									<Button Style="{StaticResource Borderless}"
										HorizontalAlignment="Left"
										cal:Message.Attach="[Event Click] = [Action Cancel($dataContext)]"
										ToolTip="{Binding Details}">
										<StackPanel Orientation="Horizontal">
											<Path Data="{StaticResource IconCancel}" Fill="Red" Stretch="Uniform" Height="15" Width="15" Margin="5" />
											<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
										</StackPanel>
									</Button>
								</StackPanel>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</DataTrigger>
				<DataTrigger Binding="{Binding IsDownloaded}" Value="True">
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate>
								<Button Style="{StaticResource Borderless}"
									Padding="3"
									HorizontalAlignment="Left"
									cal:Message.Attach="[Event Click] = [Action Open($dataContext)]"
									ToolTip="{Binding Details}">
									<StackPanel Orientation="Horizontal">
										<Image Source="{Binding FileTypeIcon}"/>
										<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
									</StackPanel>
								</Button>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</DataTrigger>
				<DataTrigger Binding="{Binding IsError}" Value="True">
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate>
								<StackPanel Orientation="Horizontal">
									<Path Data="{StaticResource IconWarning}" VerticalAlignment="Center" Margin="5"
										Fill="Red" Stretch="Fill" Height="15" Width="15" ToolTip="{Binding ErrorDetails}" />
									<Button Style="{StaticResource Borderless}"
										cal:Message.Attach="[Event Click] = [Action Download($dataContext)]"
										ToolTip="{Binding Details}">
										<StackPanel Orientation="Horizontal">
											<Path Data="{StaticResource IconRepeat}" VerticalAlignment="Center" Margin="5"
												Fill="Black" Stretch="Fill" Height="15" Width="15" />
											<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
										</StackPanel>
									</Button>
								</StackPanel>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</DataTrigger>
			</Style.Triggers>
		</Style>

		<Style x:Key="SearchTerm" TargetType="TextBox">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="TextBox">
						<themes:ListBoxChrome x:Name="Bd"
							BorderThickness="{TemplateBinding BorderThickness}"
							BorderBrush="{TemplateBinding BorderBrush}"
							Background="{TemplateBinding Background}"
							RenderMouseOver="{TemplateBinding IsMouseOver}"
							RenderFocused="{TemplateBinding IsKeyboardFocusWithin}"
							SnapsToDevicePixels="true">

							<Grid x:Name="PART_InnerGrid"
								Margin="2">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="*" />
									<ColumnDefinition Width="Auto" x:Name="ButtonColumn" />
								</Grid.ColumnDefinitions>

								<ScrollViewer x:Name="PART_ContentHost"
								Grid.Column="0" />

								<TextBlock x:Name="Watermark"
									Grid.Column="0"
									Visibility="Hidden"
									Foreground="{TemplateBinding Foreground}"
									IsHitTestVisible="False"
									Opacity="0.6"
									HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
									VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
									Text="Поиск сообщений"
									Margin="6,2,6,2" />

								<Canvas Name="SearchMarker"
									Grid.Column="1"
									Visibility="Hidden"
									Width="15"
									Height="15"
									Clip="F1 M 0,0L 48,0L 48,48L 0,48L 0,0"
									Background="Transparent">
									<Path Width="15.7781"
										Height="15.7781"
										Stretch="Fill"
										Fill="{x:Static SystemColors.ActiveBorderBrush}"
										Data="{StaticResource IconSearch}" />
								</Canvas>

								<Button x:Name="PART_ClearText" Style="{StaticResource MarkerButton}"
									Grid.Column="1" Command="{x:Static binders:Commands.CleanText}">
									<Canvas Width="8" Height="8" Background="Transparent">
										<Path Data="{StaticResource IconDelete}" Width="8"  Height="8"
											StrokeThickness="2" StrokeEndLineCap="Round" StrokeStartLineCap="Round"
											Stretch="Fill"
											Stroke="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
									</Canvas>
								</Button>
							</Grid>
						</themes:ListBoxChrome>
						<ControlTemplate.Triggers>
							<MultiTrigger>
								<MultiTrigger.Conditions>
									<Condition Property="IsKeyboardFocused" Value="False" />
									<Condition Property="Text" Value="" />
								</MultiTrigger.Conditions>
								<Setter TargetName="Watermark" Property="Visibility" Value="Visible" />
							</MultiTrigger>
							<Trigger Property="Text" Value="">
								<Setter TargetName="PART_ClearText" Property="Visibility" Value="Hidden" />
							</Trigger>
							<Trigger Property="Text" Value="">
								<Setter TargetName="SearchMarker" Property="Visibility" Value="Visible" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

	</UserControl.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*" />
			<ColumnDefinition Width="Auto" />
			<ColumnDefinition Width="2*" />
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>

		<ToolBar Grid.Row="0" Grid.ColumnSpan="3">
			<TextBox Width="400" Name="Term" Style="{StaticResource SearchTerm}" />
			<Separator />
			<Button Name="Delete">
				<StackPanel Orientation="Horizontal">
					<Path Margin="3" Data="{StaticResource IconDelete}" Stroke="Red" Height="12" Width="12" Stretch="Uniform"
						StrokeThickness="3" StrokeEndLineCap="Round" StrokeStartLineCap="Round" />
					<TextBlock VerticalAlignment="Center">Удалить</TextBlock>
				</StackPanel>
			</Button>
			<ToggleButton Style="{StaticResource FlagMarkerButton}" Name="CurrentItem_Value_IsImportant" IsEnabled="{Binding CurrentItem.HasValue}" />
			<ToggleButton Style="{StaticResource NewMarkerButton}" Name="CurrentItem_Value_IsNew" IsEnabled="{Binding CurrentItem.HasValue}" />
		</ToolBar>

		<Grid Grid.Row="1" Grid.Column="0" Margin="3">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<Grid Grid.Row="0" Margin="0, 3, 0, 3" Visibility="{Binding HasItems, Converter={StaticResource BoolToHidden}, ElementName=Items}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<ComboBox Name="Sort" HorizontalAlignment="Left" Grid.Column="0" Style="{StaticResource Borderless}" />
				<ToggleButton Name="IsAsc" HorizontalAlignment="Right" Grid.Column="1" Style="{StaticResource SortDirectionMarker}" />
			</Grid>

			<controls:ListView2 Grid.Row="1" BorderThickness="0" x:Name="Items" HorizontalContentAlignment="Stretch">
				<controls:ListView2.ItemTemplate>
					<DataTemplate>
						<Grid Margin="4">
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
							</Grid.RowDefinitions>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="Auto" />
								<ColumnDefinition Width="Auto" />
							</Grid.ColumnDefinitions>
							<ToggleButton Grid.Column="0" Grid.Row="0" Grid.RowSpan="2"
								Padding="0, 0, 10, 0"
								VerticalAlignment="Center"
								Style="{StaticResource NewMarker}"
								IsChecked="{Binding IsNew, UpdateSourceTrigger=PropertyChanged}" />
							<TextBlock Grid.Column="1" Grid.Row="0" Text="{Binding Subject}"
								Style="{StaticResource SubjectStyle}"
								FontSize="16"
								TextTrimming="CharacterEllipsis" />
							<TextBlock Grid.Column="1" Grid.Row="1" Text="{Binding Sender}"
								Style="{StaticResource SenderStyle}"
								TextTrimming="CharacterEllipsis" />
							<TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding SentAt}" HorizontalAlignment="Right"
								Foreground="{x:Static SystemColors.GrayTextBrush}" />
							<ToggleButton Grid.Column="3" Grid.Row="0" Grid.RowSpan="2" VerticalAlignment="Top"
								Style="{StaticResource FlagMarker}"
								Padding="6, 2, 0, 0"
								IsChecked="{Binding IsImportant, UpdateSourceTrigger=PropertyChanged}"/>
							<ContentControl Grid.Column="2" Grid.Row="1" HorizontalAlignment="Right"
								Visibility="{Binding HaveAttachments, Converter={StaticResource BoolToHidden}}"
								Style="{StaticResource AttachmentsMark}" />
						</Grid>
					</DataTemplate>
				</controls:ListView2.ItemTemplate>
			</controls:ListView2>
		</Grid>

		<GridSplitter Grid.Row="1"
			Grid.Column="1"
			HorizontalAlignment="Center"
			VerticalAlignment="Stretch"
			ShowsPreview="True"
			Width="5" />

		<Grid Grid.Row="1" Grid.Column="2" Margin="3" Visibility="{Binding CurrentItem.HasValue, Converter={StaticResource BoolToHidden}}">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>

			<TextBlock Grid.Row="0" Name="CurrentItem_Value_Subject" TextWrapping="Wrap" FontSize="20" />

			<Grid Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<StackPanel Grid.Column="0" Orientation="Horizontal">
					<TextBlock TextWrapping="Wrap">
						<Run Name="CurrentItem_Value_Sender"></Run>
						(<Hyperlink NavigateUri="{Binding CurrentItem.Value.SenderUri}">
							<Run Name="CurrentItem_Value_SenderEmail" />
						</Hyperlink>)
					</TextBlock>
				</StackPanel>
				<TextBlock Grid.Column="1" Text="{Binding CurrentItem.Value.SentAt}" HorizontalAlignment="Right" />
			</Grid>

			<ItemsControl Grid.Row="2" Padding="0, 10, 0, 0" Name="CurrentItem_Value_Attachments">
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<ContentControl Style="{StaticResource Attachment}" />
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>

			<TextBox Grid.Row="3" Style="{StaticResource ReadOnlyText}"
				BorderThickness="0, 1, 0, 0"
				Padding="0, 10, 0, 0"
				Margin="0, 10, 0, 0"
				FontSize="14"
				Name="CurrentItem_Value_Body" />
		</Grid>
	</Grid>
</UserControl>
